<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Thesis — Francesco Perrone</title>

  <!-- Chart.js for commit timeline -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    /* ===============================
       Minimal Japanese-inspired Theme
       =============================== */
    :root {
      --bg: #fafaf8;
      --text: #1b1b1b;
      --accent: #e60033; /* Benihi red */
      --muted: #888;
      --line: #e5e5e5;
      --font-body: 'Noto Sans JP', 'Hiragino Kaku Gothic Pro', sans-serif;
    }

    body {
      margin: 0;
      font-family: var(--font-body);
      background: var(--bg);
      color: var(--text);
    }

    header {
      text-align: center;
      border-bottom: 1px solid var(--line);
      padding: 2rem 1rem 1rem;
    }

    header h1 {
      font-weight: 500;
      font-size: 1.8rem;
      margin: 0.2em 0;
      letter-spacing: 0.03em;
    }

    header p {
      font-size: 0.9rem;
      color: var(--muted);
    }

    iframe {
      width: 100%;
      height: 75vh;
      border: none;
      display: block;
    }

    section {
      max-width: 900px;
      margin: 2rem auto;
      padding: 0 1rem;
    }

    h2 {
      font-weight: 500;
      font-size: 1.2rem;
      color: var(--accent);
      border-bottom: 1px solid var(--line);
      padding-bottom: 0.5em;
    }

    canvas {
      width: 100%;
      max-height: 300px;
      margin-top: 1em;
    }

    footer {
      text-align: center;
      font-size: 0.8rem;
      color: var(--muted);
      border-top: 1px solid var(--line);
      padding: 1.5rem 0;
    }

    a {
      color: var(--accent);
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</head>

<body>
  <header>
    <h1>Thesis Development Dashboard</h1>
    <p>Francesco Perrone — University of Glasgow</p>
  </header>

  <!-- PDF Viewer -->
  <iframe src="main.pdf#view=fitH" title="Thesis PDF Viewer"></iframe>

  <section>
    <h2>Latest Commit</h2>
    <p id="latest-commit">Loading latest commit...</p>

    <h2>Commit Timeline</h2>
    <canvas id="commitChart"></canvas>
  </section>

  <footer>
    <p>© 2025 Francesco Perrone — Hosted via <a href="https://pages.github.com/" target="_blank">GitHub Pages</a></p>
  </footer>

  <script>
    const repoOwner = "FrancescoPerrone";
    const repoName  = "thesis";
    const branch    = "master"; // ✅ your branch

    // Fetch latest commit
    fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/commits/${branch}`)
      .then(res => res.json())
      .then(data => {
        const date = new Date(data.commit.author.date).toLocaleString('en-GB', {
          year: 'numeric', month: 'short', day: 'numeric'
        });
        const msg = data.commit.message;
        document.getElementById("latest-commit").textContent = `${date} — ${msg}`;
      })
      .catch(() => {
        document.getElementById("latest-commit").textContent = "Unable to fetch latest commit.";
      });

    // Fetch recent commits for timeline
    fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/commits?sha=${branch}&per_page=40`)
      .then(res => res.json())
      .then(data => {
        const commits = data.reverse(); // oldest first
        const labels = commits.map(c => new Date(c.commit.author.date).toLocaleDateString('en-GB'));
        const cumulative = commits.map((_, i) => i + 1);

        const ctx = document.getElementById("commitChart");
        new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [{
              label: 'Commits over time',
              data: cumulative,
              borderColor: '#e60033',
              backgroundColor: 'rgba(230, 0, 51, 0.08)',
              fill: true,
              tension: 0.3,
              pointRadius: 2
            }]
          },
          options: {
            scales: {
              x: {
                title: { display: true, text: 'Date' },
                ticks: { color: '#555' },
                grid: { color: 'rgba(0,0,0,0.05)' }
              },
              y: {
                title: { display: true, text: 'Total Commits' },
                ticks: { stepSize: 1, color: '#555' },
                grid: { color: 'rgba(0,0,0,0.05)' }
              }
            },
            plugins: {
              legend: { display: false },
              tooltip: { enabled: true }
            }
          }
        });
      })
      .catch(err => console.error(err));
  </script>
</body>
</html>
